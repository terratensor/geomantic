# GeoMantic

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö GeoNames —Å Manticore Search. 
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –æ–±—ä–µ–∫—Ç–∞–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É—Å—Å–∫–æ–π –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏, –≥–µ–æ–ø–æ–∏—Å–∫ –∏ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö)
- [–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤](#-–ø—Ä–∏–º–µ—Ä—ã-–∑–∞–ø—Ä–æ—Å–æ–≤)
- [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- [–ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è](#-–ø–ª–∞–Ω—ã-—Ä–∞–∑–≤–∏—Ç–∏—è)

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. **–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö GeoNames**
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö TSV —Ñ–∞–π–ª–æ–≤ (allCountries.txt 1.8GB)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö 19 –ø–æ–ª–µ–π –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ö–µ–º—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–∞–±—É–ª—è—Ü–∏—è—Ö
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 2. **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫**
- **–†—É—Å—Å–∫–∞—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è**: `lemmatize_ru_all` (–≤—Å–µ —Ñ–æ—Ä–º—ã —Å–ª–æ–≤)
- **–ê–Ω–≥–ª–∏–π—Å–∫–∞—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è**: `stem_enru` (Porter stemmer)
- **–ò–Ω—Ñ–∏–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫**: `min_infix_len=3`
- **–¢–æ—á–Ω—ã–µ —Ñ–æ—Ä–º—ã**: `index_exact_words=1`

### 3. **–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**
- **S2 –≥–µ–æ—Ö–µ—à–∏** –¥–≤—É—Ö —Ç–∏–ø–æ–≤:
  - `uint64` –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π (`>`, `<`, `=`)
  - `string` –¥–ª—è –ø—Ä–µ—Ñ–∏–∫—Å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (`LIKE 'ebc%'`)
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å —Ç–æ—á–Ω–æ—Å—Ç–∏** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 9: ~18 –∫–º)
- **–ì–µ–æ–ø–æ–∏—Å–∫** —á–µ—Ä–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (latitude/longitude)

### 4. **–ò–µ—Ä–∞—Ä—Ö–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–µ–ª–µ–Ω–∏—è**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–∑ `hierarchy.txt` (518k —Å–≤—è–∑–µ–π)
- –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ admin –∫–æ–¥–æ–≤ (129k —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π)
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã
- **–ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (2.44M –∑–∞–ø–∏—Å–µ–π)

### 5. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏–º–µ–Ω–∞**
- 18.7M –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ preferred/short/colloquial/historic –∏–º–µ–Ω
- –Ø–∑—ã–∫–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (ru, en, other)

### 6. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏**
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≥–æ—Ç–æ–≤–∏—Ç—Å—è)
- –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (`make drop-tables`)

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç **–≥–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** (ports & adapters):

```
‚îú‚îÄ‚îÄ cmd/                    # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ geomantic/         # –û—Å–Ω–æ–≤–Ω–æ–π –∏–º–ø–æ—Ä—Ç–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ build_hierarchy/   # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ build_paths/       # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—É—Ç–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ drop_tables/       # –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ core/              
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/        # –ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ports/         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îú‚îÄ‚îÄ adapters/          
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/  # Manticore —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ downloader/    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ app/               
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/      # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pipeline/      # –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ pkg/                   # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
```

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Go 1.25.2+** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Manticore Search** - –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫
- **Docker & Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **S2 Geometry** - –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- **NDJSON** - —Ñ–æ—Ä–º–∞—Ç bulk –æ–ø–µ—Ä–∞—Ü–∏–π

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/yourusername/geomantic.git
cd geomantic

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
make init

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Manticore
make docker-up

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç
make import

# –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é
make hierarchy

# –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏
make paths

# –ò–ª–∏ –≤—Å—ë —Å—Ä–∞–∑—É
make full
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `.env`:

```env
# Manticore
MANTICORE_HOST=localhost
MANTICORE_PORT=9309
MANTICORE_TIMEOUT=30s

# Download
GEONAMES_BASE_URL=https://download.geonames.org/export/dump/
DOWNLOAD_TIMEOUT=10m
MAX_RETRIES=3

# Pipeline
BATCH_SIZE=1000
WORKERS_COUNT=4
CHANNEL_BUFFER_SIZE=10000

# S2 Geometry
S2_GEOHASH_LEVEL=9  # —É—Ä–æ–≤–µ–Ω—å —Ç–æ—á–Ω–æ—Å—Ç–∏ –≥–µ–æ—Ö–µ—à–∞ (1-30)

# Import
DATA_DIR=./data
FULL_IMPORT=true
UPDATE_ENABLED=false
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `geonames` (13.4M –∑–∞–ø–∏—Å–µ–π)
```sql
id              bigint        # GeoNames ID
name            text          # –ù–∞–∑–≤–∞–Ω–∏–µ (utf8)
asciiname       string        # ASCII –Ω–∞–∑–≤–∞–Ω–∏–µ
alternatenames  text          # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏–º–µ–Ω–∞
latitude        float         # –®–∏—Ä–æ—Ç–∞
longitude       float         # –î–æ–ª–≥–æ—Ç–∞
feature_class   string        # –ö–ª–∞—Å—Å –æ–±—ä–µ–∫—Ç–∞ (A/H/L/P/R/S/T/U/V)
feature_code    string        # –ö–æ–¥ –æ–±—ä–µ–∫—Ç–∞
country_code    string        # –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã (ISO-3166)
cc2             string        # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–¥—ã —Å—Ç—Ä–∞–Ω
admin1_code     string        # –ö–æ–¥ –∞–¥–º. –¥–µ–ª–µ–Ω–∏—è 1 —É—Ä–æ–≤–Ω—è
admin2_code     string        # –ö–æ–¥ –∞–¥–º. –¥–µ–ª–µ–Ω–∏—è 2 —É—Ä–æ–≤–Ω—è
admin3_code     string        # –ö–æ–¥ –∞–¥–º. –¥–µ–ª–µ–Ω–∏—è 3 —É—Ä–æ–≤–Ω—è
admin4_code     string        # –ö–æ–¥ –∞–¥–º. –¥–µ–ª–µ–Ω–∏—è 4 —É—Ä–æ–≤–Ω—è
population      bigint        # –ù–∞—Å–µ–ª–µ–Ω–∏–µ
elevation       int           # –í—ã—Å–æ—Ç–∞ (–º–µ—Ç—Ä—ã)
dem             int           # –¶–∏—Ñ—Ä–æ–≤–∞—è –º–æ–¥–µ–ª—å —Ä–µ–ª—å–µ—Ñ–∞
timezone        string        # –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (IANA)
modification_date timestamp    # –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
parent_id       bigint        # ID —Ä–æ–¥–∏—Ç–µ–ª—è –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏
hierarchy_path  string        # –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å
full_text       text          # –°–∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞
geohash_int     bigint        # S2 –≥–µ–æ—Ö–µ—à (uint64) –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
geohash_string  string        # S2 –≥–µ–æ—Ö–µ—à (string) –¥–ª—è –ø—Ä–µ—Ñ–∏–∫—Å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

### –¢–∞–±–ª–∏—Ü–∞ `alternate_names` (18.7M –∑–∞–ø–∏—Å–µ–π)
```sql
id              bigint        # ID –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –∏–º–µ–Ω–∏
geonameid       bigint        # ID –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
isolanguage     string        # –ö–æ–¥ —è–∑—ã–∫–∞ (ISO 639)
alternatename   text          # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è
ispreferredname bool          # –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –∏–º—è
isshortname     bool          # –ö–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è
iscolloquial    bool          # –†–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–µ –∏–º—è
ishistoric      bool          # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –∏–º—è
from_period     string        # –ü–µ—Ä–∏–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—Å)
to_period       string        # –ü–µ—Ä–∏–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–ø–æ)
language_group  string        # –ì—Ä—É–ø–ø–∞ —è–∑—ã–∫–∞ (ru/en/other)
is_official     bool          # –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –∏–º—è
```

### –¢–∞–±–ª–∏—Ü–∞ `hierarchy` (518k –∑–∞–ø–∏—Å–µ–π)
```sql
parent_id       bigint        # ID —Ä–æ–¥–∏—Ç–µ–ª—è
child_id        bigint        # ID –ø–æ—Ç–æ–º–∫–∞
relation_type   string        # –¢–∏–ø —Å–≤—è–∑–∏ (ADM/amt/...)
is_admin        bool          # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–≤—è–∑—å
is_user_defined bool          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–≤—è–∑—å
```

### –¢–∞–±–ª–∏—Ü–∞ `admin_codes` (129k –∑–∞–ø–∏—Å–µ–π)
```sql
id              bigint        # GeoNames ID
code            string        # –ö–æ–¥ –∞–¥–º. –¥–µ–ª–µ–Ω–∏—è
name            text          # –ù–∞–∑–≤–∞–Ω–∏–µ
ascii_name      string        # ASCII –Ω–∞–∑–≤–∞–Ω–∏–µ
geoname_id      bigint        # GeoNames ID
level           int           # –£—Ä–æ–≤–µ–Ω—å (1/2/5)
parent_code     string        # –ö–æ–¥ —Ä–æ–¥–∏—Ç–µ–ª—è
```

### –¢–∞–±–ª–∏—Ü–∞ `hierarchy_paths` (2.44M –∑–∞–ø–∏—Å–µ–π)
```sql
geoname_id      bigint        # ID –æ–±—ä–µ–∫—Ç–∞
path            string        # –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –ø—É—Ç—å
path_ids        string        # –ü—É—Ç—å –∏–∑ ID
depth           int           # –ì–ª—É–±–∏–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
root_id         bigint        # ID –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
```

## üîç –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
```sql
-- –ü–æ–∏—Å–∫ —Å —Ä—É—Å—Å–∫–æ–π –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–µ–π
SELECT * FROM geonames 
WHERE MATCH('–ú–æ—Å–∫–æÃÅ–≤—Å–∫–∏–π –ö—Ä–µ–º–ª—å');

-- –ü–æ–∏—Å–∫ –ø–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º –∏–º–µ–Ω–∞–º
SELECT name, alternate_names.alternatename   
FROM geonames   
INNER JOIN alternate_names ON alternate_names.geonameid = geonames.id   
WHERE MATCH('Moscow', alternate_names) AND alternate_names.isolanguage = 'en';
```

### –ì–µ–æ–ø–æ–∏—Å–∫
```sql
-- –ü–æ–∏—Å–∫ –≤ —Ä–∞–¥–∏—É—Å–µ 10 –∫–º
SELECT name, geohash_string, uint64(geohash_int), GEODIST(40.7643929, -73.9997683, latitude, longitude, {in=deg, out=m}) 
AS distance  
FROM geonames  
WHERE distance < 10000  
ORDER BY distance ASC;



-- –ü–æ–∏—Å–∫ –ø–æ –≥–µ–æ—Ö–µ—à—É (–≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –≤ –æ–¥–Ω–æ–π —è—á–µ–π–∫–µ)
SELECT name, geohash_string, uint64(geohash_int) 
FROM geonames  
WHERE geohash_int = -8520146389961801728;


-- –ü—Ä–µ—Ñ–∏–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –æ–±–ª–∞—Å—Ç–∏
SELECT name, geohash_string, uint64(geohash_int) 
FROM geonames  
WHERE match('@geohash_string aac*');

```

### –ò–µ—Ä–∞—Ä—Ö–∏—è
```sql
-- –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏
SELECT name, hierarchy_paths.path  
FROM geonames 
INNER JOIN hierarchy_paths ON hierarchy_paths.geoname_id = geonames.id WHERE match('European\\/Russia\\/*');

-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º
SELECT depth, COUNT(*)  
FROM hierarchy_paths  
GROUP BY depth  
ORDER BY depth ASC;
```

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
```sql
-- –¢–æ–ø-10 —Å—Ç—Ä–∞–Ω –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø–∏—Å–µ–π
SELECT country_code, COUNT(*) as cnt 
FROM geonames 
GROUP BY country_code 
ORDER BY cnt DESC 
LIMIT 10;

-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –æ–±—ä–µ–∫—Ç–æ–≤
SELECT feature_code, COUNT(*) as cnt 
FROM geonames 
GROUP BY feature_code 
ORDER BY cnt DESC 
LIMIT 20;

-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –≥–µ–æ—Ö–µ—à–∞–º –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
SELECT geohash_string, COUNT(*) 
FROM geonames 
GROUP BY geohash_string 
HAVING COUNT(*) > 100;
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ó–∞–ø–∏—Å–µ–π |
|----------|-------|---------|
| –ò–º–ø–æ—Ä—Ç allCountries.txt | ~20 –º–∏–Ω | 13.4M |
| –ò–º–ø–æ—Ä—Ç alternateNamesV2.txt | ~15 –º–∏–Ω | 18.7M |
| –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ | ~13 –º–∏–Ω | 518k —Å–≤—è–∑–µ–π |
| –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—É—Ç–µ–π | ~10 –º–∏–Ω | 2.44M –ø—É—Ç–µ–π |
| –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ | <100 –º—Å | - |
| –ì–µ–æ–ø–æ–∏—Å–∫ | <50 –º—Å | - |

## üìà –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [x] –ë–∞–∑–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–π –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏
- [x] –ò–µ—Ä–∞—Ä—Ö–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–µ–ª–µ–Ω–∏—è
- [x] –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏
- [x] S2 –≥–µ–æ—Ö–µ—à–∏
- [ ] –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (modifications-*.txt)
- [ ] REST API –¥–ª—è –ø–æ–∏—Å–∫–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥—Ä–∞–Ω–∏—Ü (shapes)
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë• –ê–≤—Ç–æ—Ä—ã

- –í–∞—à–µ –∏–º—è - [@audetv](https://github.com/audetv)

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- [GeoNames](https://www.geonames.org/) - –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [Manticore Search](https://manticoresearch.com/) - –∑–∞ –æ—Ç–ª–∏—á–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫
- [S2 Geometry](http://s2geometry.io/) - –∑–∞ –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
